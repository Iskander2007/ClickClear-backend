<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ ‚Äî Click&Clean</title>
    <link rel="stylesheet" href="./css/style.css" />
</head>

<body data-page="orders">
    <header class="container header">
        <div class="brand">
            <div style="width:40px;height:40px;border-radius:12px;background:#f2fff8;display:grid;place-items:center;">
                üì¶</div><span class="brand-title">Click&Clean</span>
        </div>
        <nav class="nav"><a href="./index.html">–ì–ª–∞–≤–Ω–∞—è</a><a href="./client.html">–ö–ª–∏–µ–Ω—Ç</a><a
                href="./courier.html">–ö—É—Ä—å–µ—Ä</a></nav>
        <div class="header-actions"><button id="open-auth" class="btn btn--ghost">–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button><button
                id="to-cabinet" class="btn" hidden>–í –∫–∞–±–∏–Ω–µ—Ç</button><button id="logout-btn" class="btn btn--ghost"
                hidden>–í—ã–π—Ç–∏</button></div>
    </header>

    <main class="container">
        <section class="glass">
            <h1>–°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤</h1>
            <p class="muted">–í—Å–µ –∑–∞—è–≤–∫–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ. –§–∏–ª—å—Ç—Ä—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É ‚Äî –Ω–∏–∂–µ.</p>
            <div class="filters">
                <button class="chip" data-filter="all">–í—Å–µ</button>
                <button class="chip" data-filter="new">–ù–æ–≤—ã–µ</button>
                <button class="chip" data-filter="active">–í –ø—É—Ç–∏</button>
                <button class="chip" data-filter="done">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ</button>
            </div>

            <div id="orders-mobile" class="orders-mobile"></div>

            <table class="orders-table" aria-label="–¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ö–ª–∏–µ–Ω—Ç</th>
                        <th>–ê–¥—Ä–µ—Å</th>
                        <th>–†–∞–π–æ–Ω</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ö–æ–≥–¥–∞</th>
                        <th>–ö—É—Ä—å–µ—Ä</th>
                    </tr>
                </thead>
                <tbody id="orders-body"></tbody>
            </table>
        </section>
    </main>

    <nav class="mobile-tabbar">
        <a href="./index.html" data-tab="home">üè†<span>–ì–ª–∞–≤–Ω–∞—è</span></a>
        <a href="./orders.html" data-tab="orders">üì¶<span>–ó–∞–∫–∞–∑—ã</span></a>
        <a href="./client.html" data-tab="client">üë§<span>–ö–ª–∏–µ–Ω—Ç</span></a>
        <a href="./courier.html" data-tab="courier">üõµ<span>–ö—É—Ä—å–µ—Ä</span></a>
    </nav>

    <div>
      <select id="filterDistrict"></select>
      <input id="minAmount" type="number" min="500" step="50" placeholder="–æ—Ç">
      <button id="apply">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    </div>
    <ul id="feed"></ul>

    <script type="module">
        import { getDistricts, getFeed, takeOrder } from './js/api.js';
        const $ = s => document.querySelector(s);
        const list = $('#feed');

        async function loadFilters() {
          const districts = await getDistricts();
          $('#filterDistrict').innerHTML = `<option value="">–í—Å–µ —Ä–∞–π–æ–Ω—ã</option>` +
            districts.map(d=>`<option value="${d.id}">${d.name}</option>`).join('');
        }
        loadFilters();

        async function renderFeed(params={}) {
          const data = await getFeed(params);
          list.innerHTML = data.results?.map(o => `
            <li data-id="${o.id}">
              <b>${o.amount} ‚Ç∏</b> ‚Äî ${o.address} ‚Äî ${o.district_name} ‚Äî ${o.slot}
              <button class="take">–í–∑—è—Ç—å</button>
            </li>
          `).join('') || '<li>–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</li>';
        }
        renderFeed();

        $('#apply').addEventListener('click', () => {
          const params = {};
          const d = $('#filterDistrict').value;
          const m = $('#minAmount').value;
          if (d) params.district = d;
          if (m) params.min_amount = m;
          renderFeed(params);
        });

        list.addEventListener('click', async (e) => {
          if (e.target.classList.contains('take')) {
            const id = Number(e.target.closest('li').dataset.id);
            const res = await takeOrder(id);
            alert(res.ok ? '–ó–∞–∫–∞–∑ –≤–∑—è—Ç' : (res.detail || JSON.stringify(res)));
            renderFeed();
          }
        });
    </script>

    <script src="./js/app.js" defer></script>
    <script type="module" src="./js/api.js"></script>
</body>

</html>
